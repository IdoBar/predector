bootstrap: docker
From: predector/predector-base:0.0.1-dev.1

%labels
    Author "darcy.ab.jones@gmail.com"
    Version "0.0.1-dev.1"

%help
    A containter will all dependencies for the predector pipeline.

%environment

%setup
    ANY_WAS_UNSET=false
    [ -z "${SIGNALP3:-}" ] && ANY_WAS_UNSET=true
    [ -z "${SIGNALP4:-}" ] && ANY_WAS_UNSET=true
    [ -z "${SIGNALP5:-}" ] && ANY_WAS_UNSET=true
    [ -z "${TARGETP2:-}" ] && ANY_WAS_UNSET=true
    [ -z "${DEEPLOC:-}" ] && ANY_WAS_UNSET=true
    [ -z "${PHOBIUS:-}" ] && ANY_WAS_UNSET=true
    [ -z "${TMHMM:-}" ] && ANY_WAS_UNSET=true

    if [ "${ANY_WAS_UNSET}" = "true" ]
    then
        echo "One or more of the required variables was not set." 1>&2
        echo "Please provide the variables:" 1>&2
        echo -e "- SIGNALP3\n- SIGNALP4\n- SIGNALP5\n- TARGETP2\n- DEEPLOC\n- PHOBIUS\n- TMHMM" 1>&2
        exit 1
    fi
    mkdir -p "${SINGULARITY_ROOTFS}/tmp/onbuild"

    cp "${SIGNALP3}" "${SINGULARITY_ROOTFS}/tmp/onbuild/"
    cp "${SIGNALP4}" "${SINGULARITY_ROOTFS}/tmp/onbuild/"
    cp "${SIGNALP5}" "${SINGULARITY_ROOTFS}/tmp/onbuild/"
    cp "${TARGETP2}" "${SINGULARITY_ROOTFS}/tmp/onbuild/"
    cp "${DEEPLOC}" "${SINGULARITY_ROOTFS}/tmp/onbuild/"
    cp "${PHOBIUS}" "${SINGULARITY_ROOTFS}/tmp/onbuild/"
    cp "${TMHMM}" "${SINGULARITY_ROOTFS}/tmp/onbuild/"

    echo export SIGNALP3="${SIGNALP3:-}" > "${SINGULARITY_ROOTFS}/tmp/prenv.sh"
    echo export SIGNALP4="${SIGNALP4:-}" >> "${SINGULARITY_ROOTFS}/tmp/prenv.sh"
    echo export SIGNALP5="${SIGNALP5:-}" >> "${SINGULARITY_ROOTFS}/tmp/prenv.sh"
    echo export TARGETP2="${TARGETP2:-}" >> "${SINGULARITY_ROOTFS}/tmp/prenv.sh"
    echo export DEEPLOC="${DEEPLOC:-}" >> "${SINGULARITY_ROOTFS}/tmp/prenv.sh"
    echo export PHOBIUS="${PHOBIUS:-}" >> "${SINGULARITY_ROOTFS}/tmp/prenv.sh"
    echo export TMHMM="${TMHMM:-}" >> "${SINGULARITY_ROOTFS}/tmp/prenv.sh"


%post
    . /tmp/prenv.sh
    . /.singularity.d/env/10-docker2singularity.sh

    signalp3-register "/tmp/onbuild/$(basename "${SIGNALP3}")"
    signalp4-register "/tmp/onbuild/$(basename "${SIGNALP4}")"
    signalp5-register "/tmp/onbuild/$(basename "${SIGNALP5}")"
    targetp2-register "/tmp/onbuild/$(basename "${TARGETP2}")"
    deeploc-register "/tmp/onbuild/$(basename "${DEEPLOC}")"
    phobius-register "/tmp/onbuild/$(basename "${PHOBIUS}")"
    tmhmm2-register "/tmp/onbuild/$(basename "${TMHMM}")"

    rm -rf -- /tmp/onbuild
    rm -f /tmp/prenv.sh
